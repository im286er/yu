"use strict";define(function(require,exports,module){var $=require("jquery");window.$=$;var t=require("common");$(function(){function a(t,a,e,i,l,r,n,s){$(l).prop("src");if($(i).val(t),"cover"==r)$(l).remove(),$(a).css("background","none").prepend('<div class="ui-dialog-loading"></div>'),setTimeout(function(){var e='<img id="J-cover-container" class="J-cover-container" src="'+yktGlobal.upload+t+'!c160x160.jpg"/>';$("#J-cover-button").append(e),$("#J-cover-button .msg-span").remove(),$(a).find(".ui-dialog-loading").remove()},2e3);else if("suit"==r){var o="",d="suit",c=$(a).attr("data-i"),p=$("#J-"+d+"-img-wrap-"+c);p.empty().prepend('<div class="ui-dialog-loading"></div>'),setTimeout(function(){o='<li class="upload-pic-list"><div class="u-small-close"></div><div class="u-opacity-bg"></div><img id=J-'+d+"-container-"+c+' class="J-img-container" src="'+yktGlobal.upload+t+'"/></li>',p.append(o),p.find(".ui-dialog-loading").remove()},2e3),$("#J-img-wrap"+c+" .u-small-close").on("click",function(){$("#J-img-wrap"+c+" li").remove()})}}if(require("../common/button"),require("validate"),require("../widget/ajaxupload/ajaxupload"),require("artDialog"),"apply"==yktGlobal.pageName||"edit"==yktGlobal.pageName){var e,i,l,r,n,s,o;!function(){var d=function(t,a){if(1==a){if(t>20)return dialog({title:"消息",content:"属性值不能大于20个",okValue:"确定",fixed:!0,ok:function(){}}).width(400).show(),!1;t>3&&$("#J-add-attr-btn").fadeOut()}else if(a>=2&&t>3)return dialog({title:"消息",content:"属性值不能大于3个",okValue:"确定",fixed:!0,ok:function(){}}).width(400).show(),!1;return!0},c=function(){var e=decodeURIComponent($("#J-ul-attr .input-edit").serialize()),i=$('input[name="multi"]').val(),l=[];$("#J-result-wrap .J-attr-fill").each(function(t,a){var e=$(this).closest("tr").attr("attr-mark"),i=$(this).prop("name").match("price|num|img"),r=$(this).val();l.push("attr_fill["+e+"]["+i[0]+"]="+r)}),l=l.join("&"),$.ajax({url:"/Index/Consign/attr_form",type:"post",data:e+"&multi="+i+"&"+l}).done(function(e){$("#J-result-wrap").empty().append(e);for(var i=$(".result-list").length,l=1;i>=l;l++)t.AjaxUploadPic("#J-suit-button-"+l,"#J-suit-status-"+l,"#J-suit-inputVal-"+l,"#J-suit-container-"+l,"suit",600,600,a)})};if(e=$("#J-group-attr"),i=$('input[name="multi"]'),l=$('input[name="top_attr"]'),UE.getEditor("editorDetail",{serverUrl:"/Index/Ueditor/index.html",initialFrameWidth:765,initialFrameHeight:200}),UE.getEditor("editorParam",{serverUrl:"/Index/Ueditor/index.html",initialFrameWidth:765,initialFrameHeight:200}),"apply"==yktGlobal.pageName){switch(r="",parseInt(catId)){case 4:r="<p>【页数】</p><p>【纸张】</p><p>【公式站】</p>";break;case 6:r="<p>【规格】cm循环图案</p><p>【总长】 米</p><p>【公式站】</p>";break;case 7:r="<p>【规格】</p><p>【材质】</p><p>【公式站】</p>"}setTimeout(function(){UE.getEditor("editorParam").setContent(r)},4e3)}if($(".J-radio-hide-error").on("click",function(){$(this).closest(".frame").find(".msg-span").remove()}),$("#J-no-attr").on("click",function(){var t='<div class="m-attr-data clearfix">	<div class="item m-tooltip-wrap">		<input class="u-input-text" type="text" name="stock" placeholder="请输入数量" data-rule-required="true" data-msg-required="数量不能为空" data-rule-digits="true" data-msg-digits="数量只能输入整数">		<span class="unit">件</span>  	<span class="tooltip J-msg-span"></span>  </div>	<div class="item m-tooltip-wrap">		<input class="u-input-text" type="text" name="price" placeholder="请输入售价" data-rule-required="true" data-msg-required="售价不能为空" data-rule-number="true" data-msg-number="请输入合法的售价">		<span class="unit">元</span>  	<span class="tooltip J-msg-span"></span>  </div></div>';$(this).siblings().removeClass("active").end().addClass("active"),$("#J-attr-frame").empty().append(t),i.val("0"),$('input[name="row"]').val("0")}),$("#J-multi-attr").on("click",function(){var t='<div class="multi-attr-content"><ul id="J-ul-attr"class="top"><li class="J-attr-row clearfix" data-row="1"><div class="J-attr-title attr-title m-tooltip-wrap"><input class="J-input-edit input-edit"type="text"name="attr_des[1][title]"placeholder="输入属性名"data-rule-required="true"data-msg-required="属性名不能为空"/><span class="tooltip J-msg-span"></span></div><div class="J-attr-val-frame attr-val"><div class="J-attr-val-list attr-val-list m-tooltip-wrap"><input class="J-input-edit input-edit"type="text"name="attr_des[1][val][1]"placeholder="输入属性值"data-rule-required="true"data-msg-required="属性值不能为空"/><i class="m-close close J-delete-attr-val">x</i><span class="tooltip J-msg-span"></span></div><a class="add-btn J-add-attr-val">+添加</a></div><i class="close-item m-close J-delete-attr-row">x</i></li></ul><a id="J-add-attr-btn"class="add-attr-btn"href="javascript:;">添加规格项目</a><div id="J-result-wrap"></div></div>';i.val(1),$(this).siblings().removeClass("active").end().addClass("active"),$("#J-attr-frame").empty().append(t)}),$("#J-attr-frame").delegate(".J-add-attr-val","click",function(){var t=$(this).closest("li"),a=t.find(".J-attr-val-list").length+1,e=$('input[name="multi"]').val(),i=t.attr("data-row"),l='<div class="J-attr-val-list attr-val-list m-tooltip-wrap"> 	<input class="J-input-edit input-edit" type="text" name="attr_des['+i+"][val]["+a+']" placeholder="输入属性值" data-rule-required="true" data-msg-required="属性值不能为空"/>		<i class="m-close close J-delete-attr-val">x</i>		<span class="tooltip J-msg-span"></span></div>';d(a,e)&&$(this).before(l),c()}),$("#J-attr-frame").delegate(".J-delete-attr-val","click",function(){var t=$(this).closest("li"),a=t.attr("data-row"),e=t.find(".J-attr-val-list").length;return 1==e?(dialog({title:"消息",content:"最少填写1个值",okValue:"确定",fixed:!0,ok:function(){}}).width(400).show(),!1):($(this).closest(".J-attr-val-list").remove(),t.find(".J-attr-val-list").each(function(t,e){var i=++t;$(this).find("input").prop("name","attr_des["+a+"][val]["+i+"]")}),4>=e?$("#J-add-attr-btn").fadeIn():"",void c())}),$("#J-attr-frame").delegate("#J-add-attr-btn","click",function(){var t=$(".J-attr-row").length+1;i.val(t);var a=i.val(),e='<li class="J-attr-row clearfix" data-row="'+a+'">	<div class="J-attr-title attr-title m-tooltip-wrap">			<input class="J-input-edit input-edit" type="text" name="attr_des['+a+'][title]" placeholder="输入属性名" data-rule-required="true" data-msg-required="属性名不能为空"/>			<span class="tooltip J-msg-span"></span>		</div>		<div class="J-attr-val-frame attr-val">			<div class="J-attr-val-list attr-val-list m-tooltip-wrap">				<input class="J-input-edit input-edit" type="text" name="attr_des['+a+'][val][1]" placeholder="输入属性值" data-rule-required="true" data-msg-required="属性值不能为空"/>				<i class="m-close close J-delete-attr-val">x</i>				<span class="tooltip J-msg-span"></span>			</div>			<a class="add-btn J-add-attr-val">+添加</a>		</div>		<i class="close-item m-close J-delete-attr-row">x</i></li>';$("#J-ul-attr").append(e),t>=2?$(this).fadeOut():""}),$("#J-attr-frame").delegate(".J-delete-attr-row","click",function(){var t=i.val(),a=$(this).closest("li"),e=$(".J-attr-row").length;return 1==e?(dialog({title:"消息",content:"最少填写1行",okValue:"确定",fixed:!0,ok:function(){}}).width(400).show(),!1):(a.remove(),t=--t,i.val(t),$(".J-attr-row").each(function(a,e){$(this).attr("data-row",t),$(this).find(".J-attr-title input").prop("name","attr_des["+t+"][title]"),$(this).find(".J-attr-val-list").each(function(a,e){var i=++a;$(this).find("input").prop("name","attr_des["+t+"][val]["+i+"]")})}),2>t?$("#J-add-attr-btn").fadeIn():"",void c())}),$("#J-attr-frame").delegate(".J-input-edit","blur",function(){var t=$(this).val();t?c():""}),t.AjaxUploadPic("#J-cover-button","#J-cover-status","#J-cover-inputVal","#J-cover-container","cover",640,360,a),$("#J-apply-form").validate({rules:{goods_name:{required:!0,stringCheck:!0},cp:{stringCheck:!0},instruction:{stringCheck:!0},claim:{stringCheck:!0},agreement:{required:!0},author:{required:!0}},messages:{goods_name:{required:"名称不能为空"},sample:{required:"请选择样品提供"},agreement:{required:"请勾选阅读并且同意寄售须知条款以及收费标准"},author:{required:"作者不能为空"}},errorPlacement:function(t,a){t.appendTo(a.siblings(".J-msg-span"))},submitHandler:function(t){var a=[],e=0,i="";$(".J-public-attr").each(function(){var t,i=$(this).find(".s-p-label"),l=i.hasClass("active");l&&(t=$(this).find(".active input").val(),a[e]=t,e++)}),a=a.join(),$('input[name="public_attr_ids"]').val(a),$("#J-detail-pic li").each(function(){var t=$(this).find("img").prop("src");i+='<p><img src="'+t+'"/></p>'}),$('input[name="goods_detail"]').val(i);var l=$('input[name="goods_img"]').val();if(!l)return $("#J-cover-container .msg-span").text("主图不能为空"),$("body,html").animate({scrollTop:"0"},100),!1;var r=UE.getEditor("editorParam").getContent();if(!r)return dialog({title:"消息",content:"商品参数不能为空",okValue:"确定",fixed:!0,ok:function(){}}).width(400).show(),!1;var n=UE.getEditor("editorDetail").getContent();return n?void dialog({title:"消息",content:"确认寄售请点击提交审核",okValue:"提交寄售",cancelValue:"取消返回",fixed:!0,ok:function(){t.submit()},cancel:function(){}}).width(400).showModal():(dialog({title:"消息",content:"商品详细不能为空",okValue:"确定",fixed:!0,ok:function(){}}).width(400).show(),!1)}}),"edit"==yktGlobal.pageName&&(n=$("#J-multi-attr").hasClass("active"),n&&(s=$(".m-attr-data:last").find(".upload-btn").attr("data-i"))))for(o=1;s>=o;o++)t.AjaxUploadPic("#J-suit-button-"+o,"#J-suit-status-"+o,"#J-suit-inputVal-"+o,"#J-suit-container-"+o,"suit",600,600,a)}()}else if("detail"==yktGlobal.pageName)$("#J-result-wrap .input-edit").attr("readonly",!0),$("#J-express-save").on("click",function(){dialog({title:"消息",content:"确认快递单号",okValue:"确认",cancelValue:"取消",fixed:!0,ok:function(){var t=$('input[name="cid"]').val(),a=$('input[name="express_num"]').val(),e=$('input[name="express_abbr"]').val();return a&&e?void $.ajax({url:"/Index/Consign/expressFill",type:"post",dataType:"json",data:{cid:t,express_num:a,express_abbr:e}}).done(function(t){t.code?($("#J-status").text("已经寄出货品"),$("#J-express-frame").html('<span class="show-txt">'+a+"</span>")):dialog({title:"消息",content:t.msg,okValue:"确定",fixed:!0,ok:function(){}}).width(400).show()}):(dialog({title:"消息",content:"快递公司或快递号不能为空",okValue:"确定",fixed:!0,ok:function(){}}).width(400).show(),!1)},cancel:function(){}}).width(200).showModal()});else if("pre_apply"==yktGlobal.pageName){var d;$("#J-apply-type li").on("click",function(){d=$(this).attr("data-id"),$(this).addClass("active").siblings().removeClass("active"),$("#J-next-btn").prop("href","/Index/Consign/apply/cat/"+d+".html")})}})});