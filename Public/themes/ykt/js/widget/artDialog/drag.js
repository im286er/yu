"use strict";define(function(require){var $=require("jquery"),t=$(window),e=$(document),n="createTouch"in document,o=document.documentElement,s=!("minWidth"in o.style),i=!s&&"onlosecapture"in o,r="setCapture"in o,a={start:n?"touchstart":"mousedown",over:n?"touchmove":"mousemove",end:n?"touchend":"mouseup"},h=n?function(t){return t.touches||(t=t.originalEvent.touches.item(0)),t}:function(t){return t},c=function(){this.start=$.proxy(this.start,this),this.over=$.proxy(this.over,this),this.end=$.proxy(this.end,this),this.onstart=this.onover=this.onend=$.noop};return c.types=a,c.prototype={start:function(t){return t=this.startFix(t),e.on(a.over,this.over).on(a.end,this.end),this.onstart(t),!1},over:function(t){return t=this.overFix(t),this.onover(t),!1},end:function(t){return t=this.endFix(t),e.off(a.over,this.over).off(a.end,this.end),this.onend(t),!1},startFix:function(n){return n=h(n),this.target=$(n.target),this.selectstart=function(){return!1},e.on("selectstart",this.selectstart).on("dblclick",this.end),i?this.target.on("losecapture",this.end):t.on("blur",this.end),r&&this.target[0].setCapture(),n},overFix:function(t){return t=h(t)},endFix:function(n){return n=h(n),e.off("selectstart",this.selectstart).off("dblclick",this.end),i?this.target.off("losecapture",this.end):t.off("blur",this.end),r&&this.target[0].releaseCapture(),n}},c.create=function(n,o){var s,i,r,a,h=$(n),u=new c,f=c.types.start,l=function(){},d=n.className.replace(/^\s|\s.*/g,"")+"-drag-start",p={onstart:l,onover:l,onend:l,off:function(){h.off(f,u.start)}};return u.onstart=function(o){var c="fixed"===h.css("position"),u=e.scrollLeft(),f=e.scrollTop(),l=h.width(),v=h.height();s=0,i=0,r=c?t.width()-l+s:e.width()-l,a=c?t.height()-v+i:e.height()-v;var m=h.offset(),x=this.startLeft=c?m.left-u:m.left,g=this.startTop=c?m.top-f:m.top;this.clientX=o.clientX,this.clientY=o.clientY,h.addClass(d),p.onstart.call(n,o,x,g)},u.onover=function(t){var e=t.clientX-this.clientX+this.startLeft,o=t.clientY-this.clientY+this.startTop,c=h[0].style;e=Math.max(s,Math.min(r,e)),o=Math.max(i,Math.min(a,o)),c.left=e+"px",c.top=o+"px",p.onover.call(n,t,e,o)},u.onend=function(t){var e=h.position(),o=e.left,s=e.top;h.removeClass(d),p.onend.call(n,t,o,s)},u.off=function(){h.off(f,u.start)},o?u.start(o):h.on(f,u.start),p},c});