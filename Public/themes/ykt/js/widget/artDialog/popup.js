"use strict";define(function(require){function t(){this.destroyed=!1,this.__popup=$("<div />").css({display:"none",position:"absolute",outline:0}).attr("tabindex","-1").html(this.innerHTML).appendTo("body"),this.__backdrop=this.__mask=$("<div />").css({opacity:.7,background:"#000"}),this.node=this.__popup[0],this.backdrop=this.__backdrop[0],e++}var $=require("jquery"),e=0,s=!("minWidth"in $("html")[0].style),i=!s;return $.extend(t.prototype,{node:null,backdrop:null,fixed:!1,destroyed:!0,open:!1,returnValue:"",autofocus:!0,align:"bottom left",innerHTML:"",className:"ui-popup",show:function(e){if(this.destroyed)return this;var o=this.__popup,n=this.__backdrop;if(this.__activeElement=this.__getActive(),this.open=!0,this.follow=e||this.follow,!this.__ready){if(o.addClass(this.className).attr("role",this.modal?"alertdialog":"dialog").css("position",this.fixed?"fixed":"absolute"),s||$(window).on("resize",$.proxy(this.reset,this)),this.modal){var h={position:"fixed",left:0,top:0,width:"100%",height:"100%",overflow:"hidden",userSelect:"none",zIndex:this.zIndex||t.zIndex};o.addClass(this.className+"-modal"),i||$.extend(h,{position:"absolute",width:$(window).width()+"px",height:$(document).height()+"px"}),n.css(h).attr({tabindex:"0"}).on("focus",$.proxy(this.focus,this)),this.__mask=n.clone(!0).attr("style","").insertAfter(o),n.addClass(this.className+"-backdrop").insertBefore(o),this.__ready=!0}o.html()||o.html(this.innerHTML)}return o.addClass(this.className+"-show").show(),n.show(),this.reset().focus(),this.__dispatchEvent("show"),this},showModal:function(){return this.modal=!0,this.show.apply(this,arguments)},close:function(t){return!this.destroyed&&this.open&&(void 0!==t&&(this.returnValue=t),this.__popup.hide().removeClass(this.className+"-show"),this.__backdrop.hide(),this.open=!1,this.blur(),this.__dispatchEvent("close")),this},remove:function(){if(this.destroyed)return this;this.__dispatchEvent("beforeremove"),t.current===this&&(t.current=null),this.__popup.remove(),this.__backdrop.remove(),this.__mask.remove(),s||$(window).off("resize",this.reset),this.__dispatchEvent("remove");for(var e in this)delete this[e];return this},reset:function(){var t=this.follow;return t?this.__follow(t):this.__center(),this.__dispatchEvent("reset"),this},focus:function(){var e=this.node,s=this.__popup,i=t.current,o=this.zIndex=t.zIndex++;if(i&&i!==this&&i.blur(!1),!$.contains(e,this.__getActive())){var n=s.find("[autofocus]")[0];!this._autofocus&&n?this._autofocus=!0:n=e,this.__focus(n)}return s.css("zIndex",o),t.current=this,s.addClass(this.className+"-focus"),this.__dispatchEvent("focus"),this},blur:function(){var t=this.__activeElement,e=arguments[0];return e!==!1&&this.__focus(t),this._autofocus=!1,this.__popup.removeClass(this.className+"-focus"),this.__dispatchEvent("blur"),this},addEventListener:function(t,e){return this.__getEventListener(t).push(e),this},removeEventListener:function(t,e){for(var s=this.__getEventListener(t),i=0;i<s.length;i++)e===s[i]&&s.splice(i--,1);return this},__getEventListener:function(t){var e=this.__listener;return e||(e=this.__listener={}),e[t]||(e[t]=[]),e[t]},__dispatchEvent:function(t){var e=this.__getEventListener(t);this["on"+t]&&this["on"+t]();for(var s=0;s<e.length;s++)e[s].call(this)},__focus:function(t){try{this.autofocus&&!/^iframe$/i.test(t.nodeName)&&t.focus()}catch(e){}},__getActive:function(){try{var t=document.activeElement,e=t.contentDocument,s=e&&e.activeElement||t;return s}catch(i){}},__center:function(){var t=this.__popup,e=$(window),s=$(document),i=this.fixed,o=i?0:s.scrollLeft(),n=i?0:s.scrollTop(),h=e.width(),r=e.height(),a=t.width(),l=t.height(),c=(h-a)/2+o,d=382*(r-l)/1e3+n,f=t[0].style;f.left=Math.max(parseInt(c),o)+"px",f.top=Math.max(parseInt(d),n)+"px"},__follow:function(t){var e=t.parentNode&&$(t),s=this.__popup;if(this.__followSkin&&s.removeClass(this.__followSkin),e){var i=e.offset();if(i.left*i.top<0)return this.__center()}var o=this,n=this.fixed,h=$(window),r=$(document),a=h.width(),l=h.height(),c=r.scrollLeft(),d=r.scrollTop(),f=s.width(),u=s.height(),_=e?e.outerWidth():0,p=e?e.outerHeight():0,v=this.__offset(t),m=v.left,w=v.top,g=n?m-c:m,b=n?w-d:w,x=n?0:c,y=n?0:d,E=x+a-f,k=y+l-u,N={},L=this.align.split(" "),I=this.className+"-",z={top:"bottom",bottom:"top",left:"right",right:"left"},C={top:"top",bottom:"top",left:"left",right:"left"},T=[{top:b-u,bottom:b+p,left:g-f,right:g+_},{top:b,bottom:b-u+p,left:g,right:g-f+_}],M={left:g+_/2-f/2,top:b+p/2-u/2},A={left:[x,E],top:[y,k]};$.each(L,function(t,e){T[t][e]>A[C[e]][1]&&(e=L[t]=z[e]),T[t][e]<A[C[e]][0]&&(L[t]=z[e])}),L[1]||(C[L[1]]="left"===C[L[0]]?"top":"left",T[1][L[1]]=M[C[L[1]]]),I+=L.join("-")+" "+this.className+"-follow",o.__followSkin=I,e&&s.addClass(I),N[C[L[0]]]=parseInt(T[0][L[0]]),N[C[L[1]]]=parseInt(T[1][L[1]]),s.css(N)},__offset:function(t){var e=t.parentNode,s=e?$(t).offset():{left:t.pageX,top:t.pageY};t=e?t:t.target;var i=t.ownerDocument,o=i.defaultView||i.parentWindow;if(o==window)return s;var n=o.frameElement,h=$(i),r=h.scrollLeft(),a=h.scrollTop(),l=$(n).offset(),c=l.left,d=l.top;return{left:s.left+c-r,top:s.top+d-a}}}),t.zIndex=1024,t.current=null,t});