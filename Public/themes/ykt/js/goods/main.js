"use strict";define(function(require,exports,module){var $=require("jquery"),t=require("common");require("artDialog"),require("../common/lib"),require("../common/jzoom"),$(function(){function a(){var t,a=[],o=0;$(".J-item").each(function(n,e){var i=$(this).attr("data-attr");t=$(this).hasClass("active"),t&&(a[o]=i,o++)}),l=a.join("-"),c=a.join(",")}function o(t){return isNaN(t)?(alert("请输入数字"),$("#J-buy-num").val("1"),!1):!0}function n(){var t;$(".J-amount-input").on("focus",function(){t=$(this).val()}),$(".J-amount-input").on("change",function(){var a=($(this),$(this).val());isNaN(a)?$(this).val(t):a>=d?(dialog({title:"提示",content:"库存不足",okValue:"确定",fixed:!0,ok:function(){}}).width(200).showModal(),$(this).val(t)):s=a})}function e(){function t(){return o(s)?(s=parseInt(s),void(s>1&&(s-=1,n.val(s)))):!1}function a(){return o(s)?s>=d?(dialog({title:"提示",content:"库存不足",okValue:"确定",fixed:!0,ok:function(){}}).width(200).showModal(),!1):(s=parseInt(s),s+=1,void n.val(s)):!1}var n=$("#J-buy-num");s=n.val(),$("#J-amount-increase").click(function(){a()}),$("#J-amount-decrease").click(function(){t()})}function i(t){var a=setInterval(function(){var o=0,n=0,e=0,i=0;t>0?(o=Math.floor(t/86400),n=Math.floor(t/3600)-24*o,e=Math.floor(t/60)-24*o*60-60*n,i=Math.floor(t)-24*o*60*60-60*n*60-60*e):clearInterval(a),9>=e&&(e="0"+e),9>=i&&(i="0"+i),$("#J-day-show").html(o+"天"),$("#J-hour-show").html('<s id="h"></s>'+n+"时"),$("#J-minute-show").html("<s></s>"+e+"分"),$("#J-second-show").html("<s></s>"+i+"秒"),t--},1e3)}function r(){var t=parseInt($("#J-hidden-onsale").val()),a=new Date(1e3*t),o=new Date,n=(a.getTime()-o.getTime())/1e3;i(n)}$.ajax({url:yktGlobal.controller+"/doView",type:"GET",data:{gid:goodsId}});var c,l,s,d=$('input[name="stock"]').val();a(),n(),e(),r(),$.yktTab("#J-goods-tab .tabBar span","#J-goods-tab .tabCon","current","click","0"),$(".jqzoom").jqueryzoom({xzoom:300,yzoom:300,offset:100,position:"right"}),$("#J-thumb").jdMarquee({deriction:"left",width:300,height:52,step:2,speed:4,delay:10,control:!0,_front:"#spec-right",_back:"#spec-left"}),$("#J-thumb img").on("mouseover",function(){var t=$(this).prop("src");$("#J-booth img").prop("src",t),$("#J-booth img").attr("jqimg",t)}),$("#J-basket-btn").click(function(t){var a=$("#J-buy-num").val();return $('input[name="quick"]').val(0),o(a)?void $(this).closest("form").submit():!1}),$("#J-quick-btn").on("click",function(){function a(){$("#J-quick-btn").closest("form").attr("action","/Index/Order/genernate.html").submit()}var n=$(this),e=$("#J-buy-num").val();return $('input[name="quick"]').val(1),o(e)?void $.ajax({url:"/Index/Login/isLogin",async:!1,dataType:"json"}).done(function(o){o.status?n.closest("form").attr("action","/Index/Order/genernate.html").submit():t.LoginDialog("/Index/Order/genernate.html",a)}):!1}),$("#J-collect").click(function(){if(!t.isLogin())return t.LoginDialog(),!1;var a=$(this).attr("data-switch"),o=$(this);"true"==a?$.ajax({url:yktGlobal.controller+"/doCollect",type:"POST",dataType:"json",data:{gid:goodsId,cat_id:catId,type:"+"}}).done(function(t){1==t.code?o.addClass("active").attr("data-switch","false").find("p").html("收藏成功"):2==t.code&&o.addClass("active").attr("data-switch","false").find("p").html("已收藏过")}):$.ajax({url:yktGlobal.controller+"/doCollect",type:"POST",dataType:"json",data:{gid:goodsId,type:"-"}}).done(function(t){t.code&&o.removeClass("active").attr("data-switch","true").find("p").html("收藏")})}),$("#J-like").click(function(){if(!t.isLogin())return t.LoginDialog(),!1;var a=$(this).attr("data-switch");"true"==a&&($.ajax({url:yktGlobal.controller+"/doLike",type:"POST",dataType:"json",data:{gid:goodsId}}),$(this).addClass("active").attr("data-switch","false").find("p").html("已点赞"))}),$(".J-item").on("click",function(){var t=$(this),o=$(this).hasClass("disabled");if(!o){t.siblings().removeClass("active"),t.addClass("active"),a();var n=window.location.href,e=/\/attr\//;if(e.test(n)){var i=n.split("/attr/");n=i[0]+"/attr/"+l+".html"}else{var r=n.split(".html");n=r[0]+"/attr/"+l+".html"}window.location=n}});var u=!0;$("#J-buy-read-hd").on("click",function(){u&&($("#J-buy-read-bd").load("/Index/Page/index/sign/gwxz.html"),u=!1)});var m=function(){var a=!0,o=$("#J-comment-num").text(),n={gid:goodsId,p:1,comment_num:o};return{pageControl:function(t,a,o){var n=this;$("#J-goods-tab").delegate(t,"click",function(){1==a?o.p=parseInt($(this).text()):o.p=$(t).attr("data-page"),n.ajaxComment(o)})},ajaxComment:function(a){t.faLoading("J-fa-loading","#J-user-comment-bd"),$.ajax({url:"/Index/GoodsComment/show.html",type:"post",dataType:"html",data:a}).done(function(t){setTimeout(function(){t?$("#J-user-comment-bd").empty().html(t):$("#J-user-comment-bd").empty().html('<div class="m-no-record">没有相关记录</div>')},500)})},click:function(){var t=this;$("#J-user-comment-hd").on("click",function(){a&&(n.p=1,t.ajaxComment(n))}),t.pageControl(".J-page-item",1,n),t.pageControl(".paginator-item-next",2,n),t.pageControl(".paginator-item-prev",2,n),t.pageControl(".J-comment-type",2,n)}}}();m.click()})});