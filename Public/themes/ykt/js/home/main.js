"use strict";define(function(require,exports,module){function e(t,i){function n(t,i,n,o){var d=$(".m-content").offset().top;a.faLoading("J-fa-loading",i),$.ajax({url:t,type:"POST",dataType:"html",data:{p:n,item:o}}).done(function(a){setTimeout(function(){$(i).empty().append(a),e(t,i)},500)}),a.animateTo(d)}var o=0,d=1;$(".J-page-item").off("click"),$("#J-page-prev").off("click"),$("#J-page-next").off("click"),$("#J-type dd").off("click"),$("#J-type dd").on("click",function(){o=$(this).attr("data-status"),$(this).siblings().removeClass("active").end().addClass("active"),n(t,i,d,o)}),$(".J-page-item").on("click",function(){var e=$(this).text();$(this).siblings().removeClass("paginator-item-selected").end().addClass("paginator-item-selected"),n(t,i,e)}),$("#J-page-prev").on("click",function(){var e=$(".m-paginator .paginator-item-selected"),a=e.text();a>1&&(a--,n(t,i,a),e.removeClass("paginator-item-selected").prev().addClass("paginator-item-selected"))}),$("#J-page-next").on("click",function(){var e=$(".m-paginator .paginator-item-selected"),a=e.text(),o=$('input[name="totalPageNum"]').val();o>a&&(a++,n(t,i,a),e.removeClass("paginator-item-selected").next().addClass("paginator-item-selected"))})}var $=require("jquery"),a=require("common");require("artDialog"),require("../widget/ajaxupload/ajaxupload"),require("validate"),require("../common/button"),require("datepicker"),require("datepair");var t=window.location.href,i=t.split("/Home/");if(t=i[1],"home_avatar"==yktGlobal.pageName){var n,o,d,s,l,r;!function(){var e=function(e){if($("#crop_x1").val(e.x),$("#crop_y1").val(e.y),$("#crop_x2").val(e.x2),$("#crop_y2").val(e.y2),$("#crop_w").val(e.w),$("#crop_h").val(e.h),parseInt(e.w)>0){var a=o.getBounds(),t=d/e.w,i=s/e.h;$("#crop_preview img").css({width:Math.round(t*a[0])+"px",height:Math.round(i*a[1])+"px",marginLeft:"-"+Math.round(t*e.x)+"px",marginTop:"-"+Math.round(i*e.y)+"px"})}},a=function(){if(""==$("#crop_tmp_avatar").val()){var e=dialog({title:"消息",content:" 您还没有上传头像",fixed:!0,okValue:"确 定",ok:function(){}});return e.width(320),e.showModal(),!1}$.ajax({type:"POST",url:avatarCropUpload,data:$("#form_crop_avatar").serialize(),dataType:"json",success:function(e){if(e.success){$("#crop_tmp_avatar").val(""),$("#crop_container").hide(),$("#my_avatar").html('<img src="'+e.avatar+'">'),$("#J-header-avatar").prop("src",e.avatar);var a=dialog({title:"消息",content:" 保存成功",fixed:!0,okValue:"确 定",ok:function(){}});a.width(320),a.showModal()}else alert(e.description)}})};n=require("../common/fileuploader"),require("../common/jcrop"),o=null,d=90,s=90,l=500,r=1e3,$(function(){new n.FileUploader({element:document.getElementById("upload_avatar"),action:avatarUpload,multiple:!1,disableDefaultDropzone:!0,allowedExtensions:["jpg","jpeg","png","gif"],uploadButtonText:"选择头像图片",onComplete:function(a,t,i){i.success?(null!=o&&o.destroy(),$("#crop_tmp_avatar").val(i.tmp_avatar),$("#crop_container").show(),$("#crop_target, #crop_preview").html('<img src="/Uploads/avatar/'+i.tmp_avatar+'">'),$("#crop_target img").Jcrop({allowSelect:!1,onChange:e,onSelect:e,aspectRatio:d/s,minSize:[d,s]},function(){o=this;var e,a,t,i,n=o.getBounds();n[0]/n[1]>d/s?(a=0,i=n[1],e=(n[0]-d*n[1]/s)/2,t=n[0]-e):(e=0,t=n[0],a=(n[1]-s*n[0]/d)/2,i=n[1]-a),o.setSelect([e,a,t,i])})):alert(i.description)}})}),$("#J-save-crop-btn").click(function(){a()})}()}else if("home_profile"==yktGlobal.pageName)$("#J-data").datepicker({format:"yyyy-m-d",autoclose:!0,updateDate:function(e,a){var t=e.data("pikaday");return t.setDate(a)}}),$("#j-profile-btn").on("click",function(){var e=$('textarea[name="sign"]').val(),a=$('select[name="sex"] option:selected').val(),t=$('input[name="birth"]').val();$.ajax({url:"/Index/User/profileUpdate",type:"post",dataType:"json",data:{sign:e,sex:a,birth:t}}).done(function(e){if(e.code){var a=dialog({title:"消息",content:" 保存成功",fixed:!0,okValue:"确 定",ok:function(){}});a.width(320),a.showModal()}})});else if("home_collectGoods"==yktGlobal.pageName)$(".J-cancelCollect").on("click",function(){var e=$(this).closest("li"),a=e.attr("data-id");$.ajax({url:"/Index/Goods/doCollect",type:"post",data:{gid:a,type:"-"}}),e.fadeOut()});else if("home_collectArticle"==yktGlobal.pageName)$(".J-cancelCollect").on("click",function(){var e=$(this).closest("li"),a=e.attr("data-id");$.ajax({url:"/Index/Article/doCollect",type:"post",data:{aid:a,type:"-"}}),e.fadeOut()});else if("home_address"==yktGlobal.pageName)!function(){var e=function(e,t,i){a.appendLoading("J-html-loading");var n="";"add"==t?n="/Index/Address/add":"update"==t&&(n=editAddressUrl),$.ajax({url:n,type:"POST",dataType:"html"}).done(function(a){setTimeout(function(){function n(e,a,t){$.ajax({type:"post",dataType:"json",data:{pid:a},url:"/Index/Address/subArea",success:function(a){a?(e.empty(),e.show(),$.each(a,function(a,t){o="<option value="+t.id+">"+t.areaname+"</option>",$(o).appendTo(e)}),"1"==t&&(r=s.children("option:selected").val(),n(l,r))):(t="1")?(s.hide(),l.hide()):e.hide()}})}dialog({skin:"consignee-style",title:"新增收货人信息",content:a,okValue:"保存收货人信息",fixed:!0,ok:function(){function a(){return $("#J-consignee-form").validate({errorPlacement:function(e,a){e.appendTo(a.siblings(".msg-span"))}}).form()}if(!a())return!1;var n=$('input[name="realname"]').val(),o=$("#J-ajax-province").children("option:selected").val(),d=$("#J-ajax-city").children("option:selected").val(),s=$("#J-ajax-area").children("option:selected").val(),l=$("#J-ajax-province").children("option:selected").text(),r=$("#J-ajax-city").children("option:selected").text(),c=$("#J-ajax-area").children("option:selected").text(),p=$('input[name="street"]').val(),u=$('input[name="mobile"]').val(),m=$('#J-consignee-form input[name="__hash__"]').val(),v=$('input[name="id"]').val();$.ajax({url:e,type:"post",dataType:"json",data:{id:v,realname:n,province:o,city:d,district:s,street:p,mobile:u,__hash__:m}}).done(function(e){var a=$(".J-addr-list").length+1;e.id;if("add"==t){var o='<li class="J-addr-list" data-id="'+e.id+'"><div class="l-top"><h3>'+n+" "+l+'</h3><div class="extra"><a class="del-btn J-consignee-delete" href="javascript:;">删除</a></div></div><div class="l-content"><div class="item"><span class="label">收货人：</span><div class="addr-name txt">'+n+'</div></div><div class="item"><span class="label">所在地区：</span><div class="addr-info txt">'+l+" "+r+" "+c+'</div></div><div class="item"><span class="label">地址：</span><div class="addr-street txt">'+p+'</div></div><div class="item"><span class="label">手机：</span><div class="addr-tel txt">'+u+'</div></div><div class="extra"><a class="J-setdefault" href="javascript:;">设为默认地址</a><a class="J-consignee-edit" href="javascript:;">编辑</a></div></div></li>';$("#J-consignee").append(o),1==a&&($(".J-addr-list").addClass("selected setDefault"),$(".J-addr-list .l-top h3").append('<span class="default">默认地址</span>')),$("#J-address-num").text(a)}else if("update"==t){var d=i.closest(".J-addr-list"),s=d.hasClass("setDefault");s?d.find(".l-top h3").html(n+" "+l+'<span class="default">默认地址</span>'):d.find(".l-top h3").html(n+" "+l),d.find(".addr-name").html(n),d.find(".addr-info").html(l+" "+r+" "+c),d.find(".addr-street").html(p),d.find(".addr-tel").html(u)}})}}).width(670).showModal();var o,d=$("#J-ajax-province"),s=$("#J-ajax-city"),l=$("#J-ajax-area"),r=(d.children("option:selected").val(),s.children("option:selected").val());d.change(function(){var e=$(this).children("option:selected").val();n(s,e,"1")}),s.change(function(){var e=$(this).children("option:selected").val();n(l,e)}),$("#J-html-loading").remove()},500)})};$("#J-address-wrap").delegate("#J-add-btn","click",function(){var a=$(".J-addr-list").length+1,t=$(this);5>=a?e("/Index/Address/insert","add",t):dialog({title:"提示",content:"最多可创建5个",okValue:"确定",fixed:!0,ok:function(){}}).width(200).showModal()}),$("#J-address-wrap").delegate(".J-consignee-delete","click",function(){var e=($(this),$(this).closest("li")),a=e.attr("data-id"),t=$(".J-addr-list").length-1;$.ajax({url:"/Index/Address/del",data:{id:a}}).done(function(a){e.remove(),$("#J-address-num").text(t)})}),$("#J-address-wrap").delegate(".J-consignee-edit","click",function(){var a=$(this),t=$(this).closest("li").attr("data-id");editAddressUrl="/Index/Address/edit/id/",editAddressUrl+=t,e("/Index/Address/update","update",a)}),$("#J-address-wrap").delegate(".J-setdefault","click",function(){var e=($(this),$(this).closest("li")),a=e.attr("data-id");$.ajax({type:"POST",url:"/Index/Address/setDefault",data:{id:a}}).done(function(){$(".J-addr-list").each(function(e,a){var t=$(this).hasClass("setDefault");t&&($(this).removeClass("setDefault"),$(this).find(".l-top .default").remove())}),e.addClass("setDefault"),e.find(".l-top h3").append('<span class="default">默认地址</span>')})})}();else if("home_account"==yktGlobal.pageName)$("#J-modify-btn").on("click",function(){$("#J-modify_pwd").slideToggle()}),$("#J-modify-cancel").on("click",function(){$("#J-modify_pwd").slideUp()}),$("#J-modify-submit").on("click",function(){$("#J-modify-form").validate({rules:{init_pw:{required:!0},new_pw:{required:!0,minlength:6},renew_pw:{required:!0,minlength:6,equalTo:"#new_pw"},mobile:{required:!0,isMobile:!0}},messages:{init_pw:{required:"请输入原密码"},new_pw:{required:"请输入新密码"},renew_pw:{required:"请输入重复新密码"},mobile:{required:"请输入手机号码"}},errorPlacement:function(e,a){e.appendTo(a.siblings(".error"))},submitHandler:function(e){var a=$('input[name="init_pw"]').val(),t=$('input[name="new_pw"]').val(),i=$('input[name="renew_pw"]').val(),n=$('input[name="mobile"]').val();$.ajax({url:"/Index/User/pwUpdate",type:"post",dataType:"json",data:{init_pw:a,new_pw:t,renew_pw:i,mobile:n}}).done(function(e){var a;e.code?(a="修改成功",$("#J-modify_pwd").slideUp()):a=e.msg;var t=dialog({title:"消息",content:a,fixed:!0,okValue:"确 定",ok:function(){}});t.width(320),t.showModal()})}})});else if("home_auth"==yktGlobal.pageName)$("#J-auth-form").validate({rules:{realname:{required:!0},identity:{required:!0},alipay_account:{required:!0},alipay_user:{required:!0},mobile:{required:!0,isMobile:!0}},messages:{realname:{required:"请输入真实姓名"},identity:{required:"请输入身份证号码"},alipay_account:{required:"请输入支付宝账号"},alipay_user:{required:"请输入支付宝户名"},mobile:{required:"请输入手机号码"}},errorPlacement:function(e,a){e.appendTo(a.siblings(".error"))},submitHandler:function(e){var a=$('input[name="realname"]').val(),t=$('input[name="identity"]').val(),i=$('input[name="alipay_account"]').val(),n=$('input[name="alipay_user"]').val(),o=$('input[name="mobile"]').val(),d=$('input[name="__hash__"]').val();$.ajax({url:"/Index/User/doAuth",type:"post",dataType:"json",data:{realname:a,identity:t,alipay_account:i,alipay_user:n,mobile:o,__hash__:d}}).done(function(e){if(e.code){var a=dialog({title:"消息",content:"提交成功",fixed:!0,okValue:"确 定",ok:function(){}});a.width(320),a.showModal(),$("#J-auth-form").empty().append('<div class="notice">提交成功，等待审核</div>')}})}});else if("home_order_goods_refund"==yktGlobal.pageName){var c=function(e,a,t,i){var n=$(e),o=$(a),d="pic",s="one";new AjaxUpload(n,{action:"/Index/Home/upload/folder/refund",name:"/Index/Home",onSubmit:function(e,a){if("pic"==d){if(!a||!/^(jpg|png|jpeg|gif|JPG)$/.test(a))return o.text("文件格式错误，请上传格式为.png .jpg .jpeg 的图片").show(),!1;this.setData({info:"文件类型为图片"})}o.text("文件上传中"),"one"==s&&this.disable()},onComplete:function(e,a){return a.indexOf("-")>0?($(t).val(a),$(i).attr("src","/Uploads"+a).show(),this.enable(),void 0):(o.text(a).show(),this.enable(),!1)}})};c(".J-upload-button","#J-upload-txt","#J-upload-inputVal",".J-img-container"),$(".J-choose-goods").on("click",function(){var e=$(this).attr("data-gpid"),a=$(this).attr("data-gid");$('input[name="gpid"]').val(e),$('input[name="gid"]').val(a)}),$("#J-order-servicer-btn").on("click",function(){$(this).submit()}),$("#J-order-service-form").validate({rules:{detail:{required:!0},type:{required:!0},description:{required:!0},goodsGpid:{required:!0},agree:{required:!0}},messages:{detail:{required:"问题描述不能为空"},type:{required:"请选择方式"},description:{required:"请填写问题描述"},goodsGpid:{required:"请选择商品"},agree:{required:"请勾选阅读并同意《售后政策》"}},errorPlacement:function(e,a){e.appendTo(a.siblings(".error"))},submitHandler:function(e){e.submit()}}),$(".menu").on("click",function(){$(this).find(".error").remove()}),$(".choose ul").on("click",function(){$(this).find(".error").remove()})}else if("home_priMsg"==yktGlobal.pageName){var p="/Index/PrivateMsg/msgRead";$(".J-read").on("click",function(){var e=$(this).closest("li").attr("data-id"),a=$(this);$.ajax({url:p,type:"post",data:{ids:e}}).done(function(){a.closest("li").find(".unread").remove()})}),$("#J-all-read").on("click",function(){var e=[];$("#J-container li").each(function(a,t){e[a]=$(this).attr("data-id")});var a=e.join(",");$.ajax({url:p,type:"post",data:{ids:a}}).done(function(){$("#J-container li").find(".unread").remove()})})}else if("home_order_goods_comment"==yktGlobal.pageName){var u;$(".J-open-comment").on("click",function(){function e(e){var a=e.attr("data-i");$(".J-star img").prop("src","/Public/themes/ykt/images/star_2.png"),$(".J-star img:lt("+a+")").prop("src","/Public/themes/ykt/images/star_1.png")}var a='<div class="info"><div class="item clearfix"><div class="label"><i>*</i>评分：</div><div class="frame"><div class="star J-star"><img data-i="1" src="/Public/themes/ykt/images/star_2.png"/><img data-i="2" src="/Public/themes/ykt/images/star_2.png"/><img data-i="3" src="/Public/themes/ykt/images/star_2.png"/><img data-i="4" src="/Public/themes/ykt/images/star_2.png"/><img data-i="5" src="/Public/themes/ykt/images/star_2.png"/></div></div></div><div class="item clearfix"><div class="label"><i>*</i>心得：</div><div class="frame"><textarea class="J-textarea" placeholder="商品是否给力？快分享你的购买心得吧~" ></textarea></div></div><div class="item clearfix"><div class="label"></div><div class="frame"><a class="J-submit-btn btn u-btn-primary" href="javascript:;">发表评价</a></div></div></div>';$(".J-info").empty(),$(this).siblings(".J-info").append(a),$(".J-submit-btn").on("click",function(){var e=$(this),a=$(this).closest("li").attr("data-gid"),t=$(this).closest("li").attr("data-gpid"),i=$(this).closest("li").attr("data-orderId"),n=$(".J-textarea").val(),o=$('input[name="__hash__"]').val();n.length<=60?$.ajax({url:"/Index/GoodsComment/doComment",type:"post",dataType:"json",data:{gid:a,gpid:t,order_id:i,star:u,comment:n,__hash__:o}}).done(function(a){var t;t=a.code?"评论成功":"评价失败",e.closest("li").hide();var i=dialog({title:"消息",content:t,fixed:!0,okValue:"确 定",ok:function(){}});i.width(320),i.showModal()}):dialog({title:"提示",content:"评论不能超过60个字",okValue:"确定",fixed:!0,ok:function(){}}).width(200).showModal()}),$(".J-star img").on("mouseover",function(){var a=$(this);e(a)}),$(".J-star img").on("mouseout",function(){$(".J-star img").prop("src","/Public/themes/ykt/images/star_2.png")}),$(".J-star img").on("click",function(){var a=$(this);u=$(this).attr("data-i"),e(a),$(".J-star img").off("mouseover mouseout")})})}else"home_contribute"==yktGlobal.pageName;e("/Index/Home/"+t,"#J-container")});